user www-data;
worker_processes 1;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
	worker_connections 768;
	# multi_accept on;
}

http {
	sendfile on;
	tcp_nopush on;
	tcp_nodelay on;
	keepalive_timeout 65;
	types_hash_max_size 2048;
	include /etc/nginx/mime.types;
	default_type application/octet-stream;
	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
	ssl_prefer_server_ciphers on;
	access_log /var/log/nginx/access.log;
	error_log /var/log/nginx/error.log;
	gzip on;
	include /etc/nginx/conf.d/*.conf;
	include /etc/nginx/sites-enabled/*;
}

	rtmp_auto_push on;
	rtmp_auto_push_reconnect 1s;

rtmp {

   server {
        listen 1935;
        chunk_size 8192;
        # on_publish http://localhost/acl.php;
	# max_connections 1000;

   application live {
	live on;
	interleave on;
	meta on;
	wait_key on;
	wait_video on;
	idle_streams off;
	sync 300ms;
	session_relay on;
	allow publish all;
	allow play all;
	# max_connections 500;
	publish_notify on;
	dash off;
	push rtmp://localhost/hls;
	allow play all;
	hls on;
	hls_type live;
	hls_nested on;
	hls_path /var/www/html/stream;
	hls_cleanup on;
	hls_sync 100ms;
	hls_fragment 1s;
	hls_playlist_length 10s;
	hls_fragment_naming system;
	
	# record all;
	# record_path /var/spool/rtmp;
	# record_suffix -%d-%b-%y-%T.flv;
	# exec_record_done ffmpeg -i $path -c:v h264 -flags +cgop -g 30 -hls_time 1 /var/spool/rtmp/hls/$basename.m3u8;

	#########################
	# Only do changes here	
	#
	####
	# Youtube
	#
	# push rtmp://x.rtmp.youtube.com/live2/enterstreamkeyhere;
	####
	#
	####
	# Facebook
	#
	# push rtmp://127.0.0.1:1936/rtmp/enterstreamkeyhere;
	####

    }
  }
}

